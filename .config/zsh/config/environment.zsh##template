#!/usr/bin/env zsh
# Environment variables configuration

# XDG Base Directory Specification
export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
export XDG_CACHE_HOME="${XDG_CACHE_HOME:-$HOME/.cache}"
export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
export XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"

# Dotfiles and config directories
export DOTDIR="${DOTDIR:-$HOME/git/dotfiles}"
export CONFIG_DIR="$XDG_CONFIG_HOME"
export CACHE_DIR="$XDG_CACHE_HOME"

# Zsh specific
export ZDOTDIR="${ZDOTDIR:-$CONFIG_DIR/zsh}"
export ZSH_CACHE_DIR="${ZSH_CACHE_DIR:-$CACHE_DIR/zsh}"
export HISTFILE="${HISTFILE:-$ZSH_CACHE_DIR/.zhistory}"

# Editor configuration (yadm template)
{% if yadm.hostname == "storm-desktop" %}
export EDITOR="nvim"
{% else %}
export EDITOR="vim"
{% endif %}
export VISUAL="$EDITOR"
export PAGER="${PAGER:-less}"

# Terminal configuration (replaces EOS YAD config)
{% if yadm.class == "Work" %}
export TERMINAL="alacritty"
{% else %}
export TERMINAL="xfce4-terminal"
{% endif %}

# Browser configuration
{% if yadm.class == "Work" %}
export BROWSER="google-chrome-stable"
{% else %}
export BROWSER="firefox"
{% endif %}

# EndeavourOS tool preferences (yadm way)
{% if yadm.distro == "EndeavourOS" %}
export EOS_YAD_TERMINAL="$TERMINAL"
export EOS_YAD_EDITOR="$EDITOR"
export EOS_AUR_HELPER="yay"
export EOS_CONNECTION_CHECKER="curl"
{% endif %}

# Colors for various tools
export EXA_COLORS="sn=32;4:sb=32;4:da=1"
export LS_COLORS="$(command -v dircolors &>/dev/null && dircolors -b || :)"

# Development environments
export PYENV_ROOT="${PYENV_ROOT:-$CONFIG_DIR/pyenv}"
export POETRY_PATH="${POETRY_PATH:-$HOME/.local}"
export PYTHON_CONFIGURE_OPTS="--enable-optimizations"
export CFLAGS="-O3 -march=native"
export GOPATH="${GOPATH:-$CONFIG_DIR/go}"
export NVM_DIR="${NVM_DIR:-$CONFIG_DIR/nvm}"
export CARGO_HOME="${CARGO_HOME:-$HOME/.cargo}"

# Python specific
export IPYTHONDIR="${IPYTHONDIR:-$CONFIG_DIR/ipython}"
export JUPYTER_CONFIG_DIR="${JUPYTER_CONFIG_DIR:-$CONFIG_DIR/jupyter}"
export PYTHONDONTWRITEBYTECODE=1
export PYTHONUNBUFFERED=1

# Less configuration
export LESS='-F -g -i -M -R -S -w -X -z-4'
export LESSCHARSET='utf-8'

# Man pages
export MANPAGER="${MANPAGER:-less}"
export MANWIDTH="${MANWIDTH:-80}"

# Locale
export LANG="${LANG:-en_US.UTF-8}"
export LC_ALL="${LC_ALL:-en_US.UTF-8}"

# GPG
export GPG_TTY="$(tty)"

# FZF configuration
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
export FZF_DEFAULT_OPTS='
  --height 40%
  --layout=reverse
  --border
  --inline-info
  --color=dark
  --color=fg:-1,bg:-1,hl:#5fff87,fg+:-1,bg+:-1,hl+:#ffaf5f
  --color=info:#af87ff,prompt:#5fff87,pointer:#ff87d7,marker:#ff87d7,spinner:#ff87d7
'

# PATH configuration
typeset -U path
path=(
    "$HOME/.local/bin"
    "$PYENV_ROOT/bin"
    "$POETRY_PATH/bin"
    "$CARGO_HOME/bin"
    "$GOPATH/bin"
    "/usr/local/bin"
    $path
)

# Create necessary directories
for dir in "$ZSH_CACHE_DIR" "$CONFIG_DIR" "$CACHE_DIR" "$XDG_DATA_HOME" "$XDG_STATE_HOME"; do
    [[ ! -d "$dir" ]] && mkdir -p "$dir"
done