#!/usr/bin/env bash

# Minimal Memory Usage - Clean output
# Source utility functions from dotfiles
script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$script_dir/polybar-utils.sh"

# Handle mouse clicks (simplified)
case $BLOCK_BUTTON in
    1) # Left click - show detailed memory info
        show_notification "$(get_detailed_memory_info)" "" "normal" "5000"
        ;;
    3) # Right click - open htop
        if command -v htop >/dev/null 2>&1; then
            i3-msg -q exec "xfce4-terminal -e htop"
        fi
        ;;
esac

# Get memory information
mem_total=$(grep MemTotal /proc/meminfo | awk '{print $2}')
mem_available=$(grep MemAvailable /proc/meminfo | awk '{print $2}')
mem_used=$((mem_total - mem_available))
mem_percentage=$((mem_used * 100 / mem_total))

# Convert to appropriate units
mem_used_bytes=$((mem_used * 1024))
mem_total_bytes=$((mem_total * 1024))

used_formatted=$(format_bytes "$mem_used_bytes")
total_formatted=$(format_bytes "$mem_total_bytes")

# Simple progress bar (3 characters only)
progress_bar=$(create_progress_bar "$mem_percentage" 3 "thin")

# Minimal output - just essential info
echo " ${mem_percentage}% ${progress_bar}"